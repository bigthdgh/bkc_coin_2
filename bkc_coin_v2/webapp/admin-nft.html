<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - NFT Manager</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .form-group {
            margin: 15px 0;
        }
        input, select, textarea, button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            margin: 5px 0;
        }
        textarea {
            height: 80px;
            resize: vertical;
        }
        button {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        .nft-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #f5576c;
        }
        .price-highlight {
            font-size: 20px;
            font-weight: bold;
            color: #f5576c;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #f5576c;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 15px 25px;
            background: rgba(255,255,255,0.1);
            border: none;
            cursor: pointer;
            margin-right: 10px;
            border-radius: 8px 8px 0 0;
        }
        .tab.active {
            background: rgba(245,87,108,0.3);
            border-bottom: 3px solid #f5576c;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è Admin Panel - NFT Manager</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ NFT –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –∏ —ç–∫–æ–Ω–æ–º–∏–∫–æ–π –ø—Ä–æ–µ–∫—Ç–∞</p>

        <!-- –¢–∞–±—ã -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('create')">‚ûï –°–æ–∑–¥–∞—Ç—å NFT</button>
            <button class="tab" onclick="showTab('list')">üìã –°–ø–∏—Å–æ–∫ NFT</button>
            <button class="tab" onclick="showTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <!-- –¢–∞–± —Å–æ–∑–¥–∞–Ω–∏—è NFT -->
        <div id="create-tab" class="tab-content active">
            <div class="card">
                <h2>üé® –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π NFT</h2>
                <form id="create-nft-form">
                    <div class="two-column">
                        <div>
                            <div class="form-group">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ NFT:</label>
                                <input type="text" id="nft-name" placeholder="–ó–æ–ª–æ—Ç–æ–π –±—É–ª—å–¥–æ–∑–µ—Ä" required>
                            </div>
                            <div class="form-group">
                                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                                <textarea id="nft-description" placeholder="–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –≤ 10 —Ä–∞–∑ +2000 —ç–Ω–µ—Ä–≥–∏–∏" required></textarea>
                            </div>
                            <div class="form-group">
                                <label>–¶–µ–Ω–∞ –≤ BKC:</label>
                                <input type="number" id="nft-price-bkc" placeholder="50000" step="100" min="0">
                            </div>
                            <div class="form-group">
                                <label>–¶–µ–Ω–∞ –≤ TON:</label>
                                <input type="number" id="nft-price-ton" placeholder="35.0" step="0.1" min="0">
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∞–ø–æ–≤:</label>
                                <input type="number" id="nft-tap-multiplier" placeholder="10.0" step="0.1" min="1">
                            </div>
                            <div class="form-group">
                                <label>–ë–æ–Ω—É—Å –∫ —ç–Ω–µ—Ä–≥–∏–∏:</label>
                                <input type="number" id="nft-energy-bonus" placeholder="2000" min="0">
                            </div>
                            <div class="form-group">
                                <label>–ë–æ–Ω—É—Å –∫ –¥–Ω–µ–≤–Ω—ã–º —Ç–∞–ø–∞–º:</label>
                                <input type="number" id="nft-daily-bonus" placeholder="5000" min="0">
                            </div>
                            <div class="form-group">
                                <label>–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:</label>
                                <div style="display: flex; gap: 20px;">
                                    <label><input type="checkbox" id="allow-bkc" checked> –ó–∞ BKC</label>
                                    <label><input type="checkbox" id="allow-ton" checked> –ó–∞ TON</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit">üöÄ –°–æ–∑–¥–∞—Ç—å NFT</button>
                </form>
            </div>
        </div>

        <!-- –¢–∞–± —Å–ø–∏—Å–∫–∞ NFT -->
        <div id="list-tab" class="tab-content">
            <div class="card">
                <h2>üìã –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ NFT</h2>
                <div id="nft-list">
                    <!-- NFT –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
            </div>
        </div>

        <!-- –¢–∞–± —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="stats-tab" class="tab-content">
            <div class="card">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-nfts">15</div>
                        <div>–í—Å–µ–≥–æ NFT</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="active-nfts">12</div>
                        <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö NFT</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="revenue-bkc">2.5M</div>
                        <div>–î–æ—Ö–æ–¥ –≤ BKC</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="revenue-ton">87.75</div>
                        <div>–î–æ—Ö–æ–¥ –≤ TON</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üèÜ –¢–æ–ø –ø—Ä–æ–¥–∞–≤–∞–µ–º—ã–µ NFT</h3>
                <div id="top-nfts">
                    <!-- –¢–æ–ø NFT –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'create';

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            currentTab = tabName;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–∞
            if (tabName === 'list') {
                loadNFTList();
            } else if (tabName === 'stats') {
                loadNFTStats();
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ NFT
        document.getElementById('create-nft-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const nftData = {
                name: document.getElementById('nft-name').value,
                description: document.getElementById('nft-description').value,
                price_bkc: parseFloat(document.getElementById('nft-price-bkc').value) || 0,
                price_ton: parseFloat(document.getElementById('nft-price-ton').value) || 0,
                tap_multiplier: parseFloat(document.getElementById('nft-tap-multiplier').value) || 1,
                energy_bonus: parseInt(document.getElementById('nft-energy-bonus').value) || 0,
                daily_tap_bonus: parseInt(document.getElementById('nft-daily-bonus').value) || 0,
                allow_bkc: document.getElementById('allow-bkc').checked,
                allow_ton: document.getElementById('allow-ton').checked,
            };

            try {
                const response = await fetch('/api/v1/admin/nft/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(nftData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ NFT —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    document.getElementById('create-nft-form').reset();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ NFT');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ NFT
        async function loadNFTList() {
            try {
                const response = await fetch('/api/v1/admin/nft/list');
                const result = await response.json();

                if (result.success) {
                    const nftList = document.getElementById('nft-list');
                    nftList.innerHTML = '';

                    result.nfts.forEach(nft => {
                        const nftDiv = document.createElement('div');
                        nftDiv.className = 'nft-item';
                        nftDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h3>${nft.name}</h3>
                                    <p>${nft.description}</p>
                                    <div><strong>ID:</strong> ${nft.id}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div class="price-highlight">${nft.price_bkc} BKC</div>
                                    <div>–∏–ª–∏ ${nft.price_ton} TON</div>
                                    <div><strong>–ú–Ω–æ–∂–∏—Ç–µ–ª—å:</strong> x${nft.tap_multiplier}</div>
                                    <div><strong>–≠–Ω–µ—Ä–≥–∏—è:</strong> +${nft.energy_bonus}</div>
                                    <div><strong>–¢–∞–ø—ã –≤ –¥–µ–Ω—å:</strong> +${nft.daily_tap_bonus}</div>
                                    <div style="margin-top: 10px;">
                                        <button onclick="editNFT('${nft.id}')" style="margin-right: 10px;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button onclick="deleteNFT('${nft.id}')" style="background: #e74c3c;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        nftList.appendChild(nftDiv);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ NFT:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadNFTStats() {
            try {
                const response = await fetch('/api/v1/admin/nft/stats');
                const result = await response.json();

                if (result.success) {
                    const stats = result.stats;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    document.getElementById('total-nfts').textContent = stats.total_nfts;
                    document.getElementById('active-nfts').textContent = stats.active_nfts;
                    document.getElementById('revenue-bkc').textContent = formatNumber(stats.revenue_bkc);
                    document.getElementById('revenue-ton').textContent = stats.revenue_ton.toFixed(2);

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ø NFT
                    const topNFTsDiv = document.getElementById('top-nfts');
                    topNFTsDiv.innerHTML = '';

                    stats.top_selling_nfts.forEach(nft => {
                        const nftDiv = document.createElement('div');
                        nftDiv.className = 'nft-item';
                        nftDiv.innerHTML = `
                            <h4>${nft.name}</h4>
                            <div><strong>–ü—Ä–æ–¥–∞–Ω–æ:</strong> ${nft.sold_count} —à—Ç.</div>
                            <div><strong>–î–æ—Ö–æ–¥:</strong> ${formatNumber(nft.revenue)} BKC</div>
                        `;
                        topNFTsDiv.appendChild(nftDiv);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NFT
        async function editNFT(nftId) {
            // TODO: –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            alert('üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ NFT –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ NFT
        async function deleteNFT(nftId) {
            if (!confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç NFT? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }

            try {
                const response = await fetch(`/api/v1/admin/nft/delete?id=${nftId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ NFT —É–¥–∞–ª–µ–Ω!');
                    loadNFTList(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è NFT:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ NFT');
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        };
    </script>
</body>
</html>
