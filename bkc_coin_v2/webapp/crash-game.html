<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ –†–∞–∫–µ—Ç–∫–∞ - BKC Coin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(245, 87, 108, 0.5);
        }
        
        .crash-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .multiplier-display {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(245, 87, 108, 0.5);
        }
        
        .bet-button {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            transition: all 0.3s ease;
        }
        
        .bet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
        }
        
        .cashout-button {
            background: linear-gradient(45deg, #00ff88, #00cc66);
        }
        
        .crashed {
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .stats-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        }
        
        .live-indicator {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4">
        <!-- Header -->
        <header class="glass-effect rounded-2xl p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold text-white mb-2">üöÄ –†–∞–∫–µ—Ç–∫–∞</h1>
                    <p class="text-gray-300">Provably Fair Crash Game</p>
                </div>
                <div class="text-right">
                    <div class="text-white text-sm mb-1">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                    <div class="text-3xl font-bold text-yellow-400" id="user-balance">0 BKC</div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ -->
            <div class="lg:col-span-2 space-y-6">
                <!-- –¢–µ–∫—É—â–∞—è –∏–≥—Ä–∞ -->
                <div class="glass-effect rounded-2xl p-8 neon-glow">
                    <div class="text-center mb-6">
                        <div class="flex justify-center items-center mb-4">
                            <span class="live-indicator bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold">LIVE</span>
                            <span class="ml-3 text-gray-300">–ò–≥—Ä–∞ #<span id="game-id">12345</span></span>
                        </div>
                        
                        <div id="multiplier" class="multiplier-display crash-animation">
                            1.00x
                        </div>
                        
                        <div class="mt-4 text-gray-300">
                            <div class="text-sm">–•—ç—à: <code id="game-hash" class="text-xs">a1b2c3d4e5f6...</code></div>
                            <div class="text-xs mt-1">Provably Fair ‚úÖ</div>
                        </div>
                    </div>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—è -->
                    <div class="mt-6">
                        <canvas id="crash-chart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã -->
                    <div class="grid grid-cols-3 gap-4 mt-6">
                        <div class="text-center">
                            <div class="text-gray-400 text-sm">–ò–≥—Ä–æ–∫–æ–≤</div>
                            <div class="text-white font-bold" id="players-count">0</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-sm">–û–±—â–∏–π –±–∞–Ω–∫</div>
                            <div class="text-green-400 font-bold" id="total-bets">0 BKC</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-sm">–ü–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</div>
                            <div class="text-yellow-400 font-bold" id="winners-count">0</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å —Å—Ç–∞–≤–æ–∫ -->
                <div class="glass-effect rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</h3>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="text-gray-300 text-sm">–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (BKC)</label>
                            <input type="number" id="bet-amount" class="w-full bg-gray-800 text-white rounded-lg p-3" 
                                   placeholder="1000" min="1000" step="1000">
                        </div>
                        <div>
                            <label class="text-gray-300 text-sm">–ê–≤—Ç–æ-–∫—ç—à–∞—É—Ç</label>
                            <input type="number" id="auto-cashout" class="w-full bg-gray-800 text-white rounded-lg p-3" 
                                   placeholder="2.00" min="1.01" max="10.00" step="0.01">
                        </div>
                    </div>
                    
                    <div class="flex gap-4">
                        <button onclick="placeBet()" class="flex-1 bet-button text-white font-bold py-4 rounded-lg">
                            üöÄ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                        </button>
                        <button onclick="cashout()" class="flex-1 cashout-button text-white font-bold py-4 rounded-lg" id="cashout-btn" disabled>
                            üí∞ –ó–∞–±—Ä–∞—Ç—å
                        </button>
                    </div>
                    
                    <div class="mt-4 text-center text-gray-400 text-sm">
                        –ú–∏–Ω. —Å—Ç–∞–≤–∫–∞: 1,000 BKC | –ö–æ–º–∏—Å—Å–∏—è: 3%
                    </div>
                </div>
            </div>
            
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="space-y-6">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä -->
                <div class="glass-effect rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4">üìä –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h3>
                    <div id="game-history" class="space-y-2">
                        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—é–¥–∞ -->
                    </div>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="glass-effect rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="space-y-3">
                        <div class="stats-card rounded-lg p-3">
                            <div class="text-gray-400 text-sm">–ò–≥—Ä —Å–µ–≥–æ–¥–Ω—è</div>
                            <div class="text-white font-bold" id="games-today">0</div>
                        </div>
                        <div class="stats-card rounded-lg p-3">
                            <div class="text-gray-400 text-sm">–ú–∞–∫—Å. –º–Ω–æ–∂–∏—Ç–µ–ª—å</div>
                            <div class="text-green-400 font-bold" id="max-multiplier">0.00x</div>
                        </div>
                        <div class="stats-card rounded-lg p-3">
                            <div class="text-gray-400 text-sm">–ü—Ä–∏–±—ã–ª—å —Å–∏—Å—Ç–µ–º—ã</div>
                            <div class="text-yellow-400 font-bold" id="system-profit">0 BKC</div>
                        </div>
                    </div>
                </div>
                
                <!-- –¢–æ–ø –∏–≥—Ä–æ–∫–∏ -->
                <div class="glass-effect rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-white mb-4">üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–∏</h3>
                    <div id="top-players" class="space-y-2">
                        <!-- –¢–æ–ø –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentGame = {
            id: 'crash_1234567890',
            multiplier: 1.00,
            status: 'active',
            crashPoint: 2.45,
            startTime: Date.now()
        };
        
        let userBet = null;
        let crashChart = null;
        let chartData = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TonConnect
        const tonConnect = new TonConnectUI({
            manifestUrl: 'https://your-app.com/tonconnect-manifest.json',
            buttonRootId: 'ton-connect-button'
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function initChart() {
            const ctx = document.getElementById('crash-chart').getContext('2d');
            crashChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å',
                        data: [],
                        borderColor: 'rgb(245, 87, 108)',
                        backgroundColor: 'rgba(245, 87, 108, 0.1)',
                        borderWidth: 3,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return value.toFixed(2) + 'x';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä—ã
        async function loadCurrentGame() {
            try {
                const response = await fetch('/api/v1/games/crash/current');
                const result = await response.json();
                
                if (result.success) {
                    currentGame = result.game;
                    updateGameDisplay();
                    startGameSimulation();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–≥—Ä—ã
        function updateGameDisplay() {
            document.getElementById('game-id').textContent = currentGame.id.split('_')[1];
            document.getElementById('game-hash').textContent = currentGame.hash.substring(0, 12) + '...';
            document.getElementById('multiplier').textContent = currentGame.multiplier.toFixed(2) + 'x';
            document.getElementById('players-count').textContent = currentGame.total_players || 0;
            document.getElementById('total-bets').textContent = formatNumber(currentGame.total_bets || 0);
            document.getElementById('winners-count').textContent = currentGame.total_winners || 0;
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã
        function startGameSimulation() {
            let elapsed = 0;
            const interval = setInterval(() => {
                elapsed += 100;
                
                if (currentGame.status === 'active') {
                    // –†–æ—Å—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è
                    currentGame.multiplier = 1 + (elapsed / 1000) * 0.5;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –≥—Ä–∞—Ñ–∏–∫
                    chartData.push({x: elapsed, y: currentGame.multiplier});
                    if (chartData.length > 50) chartData.shift();
                    
                    crashChart.data.labels = chartData.map(d => d.x);
                    crashChart.data.datasets[0].data = chartData.map(d => d.y);
                    crashChart.update('none');
                    
                    updateGameDisplay();
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∞—Ö
                    if (currentGame.multiplier >= currentGame.crashPoint) {
                        crashGame();
                        clearInterval(interval);
                    }
                }
            }, 100);
        }
        
        // –ö—Ä–∞—Ö –∏–≥—Ä—ã
        function crashGame() {
            currentGame.status = 'crashed';
            document.getElementById('multiplier').classList.add('crashed');
            document.getElementById('multiplier').textContent = 'CRASHED! ' + currentGame.crashPoint.toFixed(2) + 'x';
            
            if (userBet && !userBet.cashedOut) {
                showMessage('üí• –ò–≥—Ä–∞ –≤–∑–æ—Ä–≤–∞–ª–∞—Å—å! –°—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞.', 'error');
            }
            
            // –ù–æ–≤–∞—è –∏–≥—Ä–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                document.getElementById('multiplier').classList.remove('crashed');
                loadCurrentGame();
            }, 5000);
        }
        
        // –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
        async function placeBet() {
            const amount = parseInt(document.getElementById('bet-amount').value);
            const autoCashout = parseFloat(document.getElementById('auto-cashout').value);
            
            if (!amount || amount < 1000) {
                showMessage('‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 1,000 BKC', 'error');
                return;
            }
            
            if (!autoCashout || autoCashout < 1.01 || autoCashout > 10.0) {
                showMessage('‚ùå –ê–≤—Ç–æ-–∫—ç—à–∞—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1.01x –¥–æ 10.0x', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/v1/games/crash/bet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: 123456789,
                        amount: amount,
                        auto_cashout: autoCashout
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userBet = {
                        id: result.bet_id,
                        amount: amount,
                        autoCashout: autoCashout,
                        cashedOut: false
                    };
                    
                    document.getElementById('cashout-btn').disabled = false;
                    showMessage('‚úÖ –°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!', 'success');
                    
                    // –ê–≤—Ç–æ-–∫—ç—à–∞—É—Ç
                    if (autoCashout > 1.0) {
                        checkAutoCashout();
                    }
                } else {
                    showMessage('‚ùå ' + (result.error || '–û—à–∏–±–∫–∞ —Å—Ç–∞–≤–∫–∏'), 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å—Ç–∞–≤–∫–∏:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç–∞–≤–∫–µ', 'error');
            }
        }
        
        // –ö—ç—à–∞—É—Ç
        async function cashout() {
            if (!userBet || userBet.cashedOut) {
                return;
            }
            
            try {
                const response = await fetch(`/api/v1/games/crash/cashout?bet_id=${userBet.id}&user_id=123456789`);
                const result = await response.json();
                
                if (result.success) {
                    userBet.cashedOut = true;
                    document.getElementById('cashout-btn').disabled = true;
                    
                    showMessage(`üí∞ –ó–∞–±—Ä–∞–Ω–æ: ${formatNumber(result.result.win_amount)} BKC!`, 'success');
                    updateUserBalance(result.result.win_amount);
                } else {
                    showMessage('‚ùå ' + (result.error || '–û—à–∏–±–∫–∞ –∫—ç—à–∞—É—Ç–∞'), 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∫—ç—à–∞—É—Ç–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫—ç—à–∞—É—Ç–µ', 'error');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ-–∫—ç—à–∞—É—Ç–∞
        function checkAutoCashout() {
            const interval = setInterval(() => {
                if (userBet && !userBet.cashedOut && currentGame.multiplier >= userBet.autoCashout) {
                    cashout();
                    clearInterval(interval);
                }
                if (currentGame.status === 'crashed') {
                    clearInterval(interval);
                }
            }, 100);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
        async function loadGameHistory() {
            try {
                const response = await fetch('/api/v1/games/crash/history?limit=5');
                const result = await response.json();
                
                if (result.success) {
                    const historyDiv = document.getElementById('game-history');
                    historyDiv.innerHTML = '';
                    
                    result.history.forEach(game => {
                        const gameDiv = document.createElement('div');
                        gameDiv.className = 'bg-gray-800 rounded-lg p-3';
                        
                        const statusColor = game.crash_point <= 1.01 ? 'text-red-400' : 'text-green-400';
                        const statusText = game.crash_point <= 1.01 ? 'üí•' : '‚úÖ';
                        
                        gameDiv.innerHTML = `
                            <div class="flex justify-between items-center">
                                <span class="text-white font-semibold">#${game.id.split('_')[1]}</span>
                                <span class="${statusColor}">${statusText} ${game.crash_point.toFixed(2)}x</span>
                            </div>
                            <div class="text-gray-400 text-xs mt-1">
                                –ë–∞–Ω–∫: ${formatNumber(game.total_bets)} BKC
                            </div>
                        `;
                        
                        historyDiv.appendChild(gameDiv);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/api/v1/games/stats');
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.stats;
                    document.getElementById('games-today').textContent = stats.total_games_today;
                    document.getElementById('max-multiplier').textContent = stats.biggest_multiplier_today.toFixed(2) + 'x';
                    document.getElementById('system-profit').textContent = formatNumber(stats.system_profit_today);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showMessage(text, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg text-white font-semibold z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.textContent = text;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        function updateUserBalance(amount) {
            const balanceEl = document.getElementById('user-balance');
            const currentBalance = parseInt(balanceEl.textContent.replace(/[^0-9]/g, ''));
            balanceEl.textContent = formatNumber(currentBalance + amount) + ' BKC';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            initChart();
            loadCurrentGame();
            loadGameHistory();
            loadStats();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                loadStats();
            }, 10000);
        };
    </script>
</body>
</html>
