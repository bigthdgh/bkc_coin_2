<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Vesting (300 –º–ª–Ω BKC)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .vesting-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #f5576c;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
            transition: width 0.5s;
            border-radius: 10px;
        }
        .withdrawal-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #f5576c;
        }
        .form-group {
            margin: 15px 0;
        }
        input, button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            margin: 5px 0;
        }
        button {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:disabled {
            background: rgba(255,255,255,0.2);
            cursor: not-allowed;
            transform: scale(1);
        }
        .countdown {
            background: rgba(255,0,0,0.1);
            border: 1px solid rgba(255,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .countdown-number {
            font-size: 48px;
            font-weight: bold;
            color: #ff6b6b;
        }
        .success-message {
            background: rgba(0,255,0,0.1);
            border: 1px solid rgba(0,255,0,0.3);
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Admin Vesting Panel</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–≤–æ–∏–º–∏ 300 –º–ª–Ω BKC (–∑–∞–º–æ—Ä–æ–∑–∫–∞ –Ω–∞ 5 –º–µ—Å—è—Ü–µ–≤, –≤—ã–≤–æ–¥ –ø–æ 10% –µ–∂–µ–º–µ—Å—è—á–Ω–æ)</p>

        <!-- –û–±–∑–æ—Ä –≤–µ—Å—Ç–∏–Ω–≥–∞ -->
        <div class="card">
            <h2>üìä –û–±–∑–æ—Ä –≤–µ—Å—Ç–∏–Ω–≥–∞</h2>
            <div class="vesting-overview">
                <div class="stat-card">
                    <div class="stat-number">300.0 –º–ª–Ω</div>
                    <div class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">–ú–µ—Å—è—Ü–µ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">10%</div>
                    <div class="stat-label">–í –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">30.0 –º–ª–Ω</div>
                    <div class="stat-label">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="withdrawn-total">60.0 –º–ª–Ω</div>
                    <div class="stat-label">–í—ã–≤–µ–¥–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="remaining-amount">240.0 –º–ª–Ω</div>
                    <div class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <div class="card">
            <h2>üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–µ—Å—Ç–∏–Ω–≥–∞</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="vesting-progress" style="width: 20%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: <strong>20%</strong> (2 –∏–∑ 5 –º–µ—Å—è—Ü–µ–≤)</span>
                <span>–û—Å—Ç–∞–ª–æ—Å—å: <strong>3 –º–µ—Å—è—Ü–∞</strong></span>
            </div>
        </div>

        <!-- –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç -->
        <div class="countdown" id="countdown-section" style="display: none;">
            <h3>‚è∞ –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã–≤–æ–¥–∞</h3>
            <div class="countdown-number" id="countdown-days">15</div>
            <div>–¥–Ω–µ–π</div>
        </div>

        <!-- –§–æ—Ä–º–∞ –≤—ã–≤–æ–¥–∞ -->
        <div class="card">
            <h2>üí∏ –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥</h2>
            <form id="withdrawal-form">
                <div class="form-group">
                    <label>–°—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ (BKC):</label>
                    <input type="number" id="withdrawal-amount" placeholder="30000000" min="1" max="30000000">
                    <small>–î–æ—Å—Ç—É–ø–Ω–æ: <span id="available-amount">30.0 –º–ª–Ω</span> BKC</small>
                </div>
                <button type="submit" id="withdrawal-btn">üí∏ –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥</button>
            </form>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ -->
        <div class="card">
            <h2>üìã –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤</h2>
            <div id="withdrawal-history">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ -->
        <div class="card">
            <h2>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥</h2>
            <p>–ö–∞–∂–¥–æ–µ 15-–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç —Ç–≤–æ–∏ 30 –º–ª–Ω BKC</p>
            <button onclick="triggerAutoWithdrawal()" style="width: auto;">‚ö° –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–≤—ã–≤–æ–¥</button>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card">
            <h2>üìÑ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div id="vesting-details">
                <!-- –î–µ—Ç–∞–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="message" class="success-message" style="display: none;"></div>

    <script>
        let vestingData = {
            totalAmount: 300000000,
            monthlyAmount: 30000000,
            currentMonth: 2,
            totalWithdrawn: 60000000,
            remainingAmount: 240000000,
            nextWithdrawDate: "2024-03-15",
            isCompleted: false
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Å—Ç–∏–Ω–≥–∞
        async function loadVestingStatus() {
            try {
                const response = await fetch('/api/v1/admin/vesting/status');
                const result = await response.json();

                if (result.success) {
                    updateVestingUI(result.vesting);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateVestingUI(data) {
            vestingData = data.current_status;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            document.getElementById('withdrawn-total').textContent = formatNumber(data.total_withdrawn);
            document.getElementById('remaining-amount').textContent = formatNumber(data.remaining_amount);
            document.getElementById('available-amount').textContent = formatNumber(data.remaining_amount);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progressPercent = data.progress_percent;
            document.getElementById('vesting-progress').style.width = progressPercent + '%';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç
            updateCountdown(data.next_withdraw_date);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
        function updateCountdown(nextDateStr) {
            const nextDate = new Date(nextDateStr);
            const now = new Date();
            const diffTime = nextDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays > 0) {
                document.getElementById('countdown-section').style.display = 'block';
                document.getElementById('countdown-days').textContent = diffDays;
            } else {
                document.getElementById('countdown-section').style.display = 'none';
            }
        }

        // –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥
        document.getElementById('withdrawal-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const amount = parseInt(document.getElementById('withdrawal-amount').value);

            if (!amount || amount <= 0) {
                showMessage('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                return;
            }

            if (amount > vestingData.remainingAmount) {
                showMessage(`‚ö†Ô∏è –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ ${formatNumber(vestingData.remainingAmount)} BKC`, 'error');
                return;
            }

            try {
                const response = await fetch('/api/v1/admin/vesting/withdraw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: amount })
                });

                const result = await response.json();

                if (result.success) {
                    showMessage(`‚úÖ ${result.message}`, 'success');
                    document.getElementById('withdrawal-form').reset();
                    loadVestingStatus(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å
                } else {
                    showMessage(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ –≤—ã–≤–æ–¥', 'error');
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥
        async function triggerAutoWithdrawal() {
            try {
                const response = await fetch('/api/v1/admin/vesting/auto-withdraw');
                const result = await response.json();

                if (result.success) {
                    showMessage(`‚úÖ ${result.message}`, 'success');
                    loadVestingStatus(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å
                } else {
                    showMessage(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–≤—ã–≤–æ–¥–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–≤—ã–≤–æ–¥–∞', 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–≤–æ–¥–æ–≤
        async function loadWithdrawalHistory() {
            try {
                const response = await fetch('/api/v1/admin/vesting/history');
                const result = await response.json();

                if (result.success) {
                    const historyDiv = document.getElementById('withdrawal-history');
                    historyDiv.innerHTML = '';

                    result.withdrawals.forEach(withdrawal => {
                        const item = document.createElement('div');
                        item.className = 'withdrawal-item';
                        item.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4>–ú–µ—Å—è—Ü ${withdrawal.month}</h4>
                                    <div><strong>–î–∞—Ç–∞:</strong> ${withdrawal.withdraw_date}</div>
                                    <div><strong>–°—É–º–º–∞:</strong> ${formatNumber(withdrawal.amount)} BKC</div>
                                    <div><strong>–ü—Ä–æ—Ü–µ–Ω—Ç:</strong> ${withdrawal.percentage}%</div>
                                </div>
                                <div style="text-align: right;">
                                    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${withdrawal.status}</div>
                                    ${withdrawal.transaction_hash ? `<div><strong>–•–µ—à:</strong> ${withdrawal.transaction_hash}</div>` : ''}
                                </div>
                            </div>
                        `;
                        historyDiv.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        async function loadVestingDetails() {
            try {
                const response = await fetch('/api/v1/admin/vesting/details');
                const result = await response.json();

                if (result.success) {
                    const detailsDiv = document.getElementById('vesting-details');
                    const details = result.details;
                    
                    detailsDiv.innerHTML = `
                        <h3>üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Å—Ç–∏–Ω–≥–∞</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4>–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> ${details.vesting_info.formatted_total}</p>
                                <p><strong>–ü–µ—Ä–∏–æ–¥:</strong> ${details.vesting_info.period_months} –º–µ—Å—è—Ü–µ–≤</p>
                                <p><strong>–ü—Ä–æ—Ü–µ–Ω—Ç –≤ –º–µ—Å—è—Ü:</strong> ${details.vesting_info.percent_per_month}%</p>
                                <p><strong>–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è —Å—É–º–º–∞:</strong> ${details.vesting_info.formatted_monthly}</p>
                                <p><strong>–ù–∞—á–∞–ª–æ:</strong> ${details.vesting_info.start_date}</p>
                                <p><strong>–û–∫–æ–Ω—á–∞–Ω–∏–µ:</strong> ${details.vesting_info.end_date}</p>
                            </div>
                            <div>
                                <h4>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h4>
                                <p><strong>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</strong> ${details.current_status.current_month} –∏–∑ ${details.vesting_info.period_months}</p>
                                <p><strong>–í—ã–≤–µ–¥–µ–Ω–æ:</strong> ${details.current_status.formatted_withdrawn}</p>
                                <p><strong>–û—Å—Ç–∞–ª–æ—Å—å:</strong> ${details.current_status.formatted_remaining}</p>
                                <p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> ${details.current_status.progress_percent.toFixed(1)}%</p>
                                <p><strong>–°–ª–µ–¥—É—é—â–∏–π –≤—ã–≤–æ–¥:</strong> ${details.current_status.next_withdraw_date}</p>
                                <p><strong>–î–Ω–µ–π –¥–æ –≤—ã–≤–æ–¥–∞:</strong> ${details.current_status.days_until_next}</p>
                                <p><strong>–ó–∞–≤–µ—Ä—à–µ–Ω:</strong> ${details.current_status.is_completed ? '–î–∞' : '–ù–µ—Ç'}</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π:', error);
            }
        }

        // –ü–æ–∫–∞–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
        function showMessage(text, type = 'success') {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `success-message ${type}`;
            messageEl.style.display = 'block';

            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (num >= 1000000000 {
                return (num / 1000000000).toFixed(1) + ' –º–ª—Ä–¥';
            } else if (num >= 1000000 {
                return (num / 1000000).toFixed(1) + ' –º–ª–Ω';
            } else if (num >= 1000 {
                return (num / 1000).toFixed(1) + ' —Ç—ã—Å';
            }
            return num.toString();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            loadVestingStatus();
            loadWithdrawalHistory();
            loadVestingDetails();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç—Å—á–µ—Ç –∫–∞–∂–¥—ã–µ –º–∏–Ω—É—Ç—É
            setInterval(updateCountdown.bind(null, vestingData.nextWithdrawDate), 60000);
        };
    </script>
</body>
</html>
